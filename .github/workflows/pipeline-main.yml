name: Main Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  repository_dispatch:
    types: [ok-to-test]

jobs:
  static-analysis:
    uses: ./.github/workflows/static-analysis.yml

  build:
    uses: ./.github/workflows/build.yml
    secrets: inherit
    needs: [static-analysis]
    if: success()
  
  unit-tests:
    needs: [build]
    if: success()
    uses: ./.github/workflows/unit-tests.yml
    with:
      os: linux
      arch: amd64

  integration-tests:
    needs: [build]
    if: success()
    uses: ./.github/workflows/integration-tests.yml
    with:
      os: linux
      arch: amd64

  testcontainers-suite:
    needs: [build]
    if: success()
    uses: ./.github/workflows/testcontainers-suite.yml
    with:
      os: linux
      arch: amd64
