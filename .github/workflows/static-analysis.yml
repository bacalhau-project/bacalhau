name: Static Analysis

on:
  pull_request:
    branches: [main]
  workflow_call:

jobs:
  static-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Setup common tools with caching
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version-file: go.work
          cache: true

      - name: Setup Dummy WebUi Build
        run: |
          mkdir -p webui/build && touch webui/build/index.html

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"
          cache: "pip"

      # Install dependencies
      - name: Install Python dependencies
        run: |
          python -m pip install pre-commit

      # Run all static analysis checks
      - name: Run CSpell
        uses: streetsidesoftware/cspell-action@v5

      - name: Validate Swagger
        uses: ./.github/actions/swagger-validation

      - name: Run pre-commit checks
        run: |
          pre-commit run --show-diff-on-failure --color=always --all-files

      - name: Run golangci-lint
        uses: golangci/golangci-lint-action@v6.5.1
        with:
          skip-cache: false
          version: v1.64.5
